<script>
    const SHEET_ID = "1qYSyKcT5TxCpjT0ZQ2GyVtycmm4CB7VZF7UKS85JrTI";
    const CORRECT_PIN = "9191";

    document.getElementById("pin").addEventListener("input", (e) => {
        if (e.target.value === CORRECT_PIN) {
            document.getElementById("pinScreen").style.display = "none";
            document.getElementById("passwordList").style.display = "block";
            loadPasswords();
        }
    });

    async function loadPasswords() {
        try {
            // Add timestamp to bypass cache
            const timestamp = new Date().getTime();
            const url = `https://opensheet.elk.sh/${SHEET_ID}/Sheet1?t=${timestamp}`;
            
            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to fetch");
            
            const data = await response.json();
            if (!data.length) throw new Error("No data found");
            
            const sorted = data.sort((a, b) => (a.Order || 0) - (b.Order || 0));
            renderPasswords(sorted);
            
        } catch (error) {
            console.error("Error:", error);
            alert("Error loading data. Check console for details.");
        }
    }

    function renderPasswords(data) {
        let html = "";
        data.forEach(item => {
            if (!item.Name) return;
            html += `<div class="entry">
                <h3>${item.Name}</h3>
                ${item.Email ? `<p>Email: ${item.Email} <button onclick="copy('${item.Email}')">Copy</button></p>` : ""}
                ${item.User ? `<p>User: ${item.User} <button onclick="copy('${item.User}')">Copy</button></p>` : ""}
                ${item.Password ? `<p>Password: •••••••• <button onclick="copy('${item.Password}')">Copy</button></p>` : ""}
            </div>`;
        });
        document.getElementById("entries").innerHTML = html || "<p>No entries found.</p>";
    }

    function copy(text) {
        navigator.clipboard.writeText(text);
        alert("Copied to clipboard!");
    }
</script>
